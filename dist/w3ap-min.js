/*!
 * w3ap - v0.6.0 - 2014-05-09
 * https://github.com/jylauril/w3ap
 * Copyright (c) 2014 Jyrki Laurila <https://github.com/jylauril>
 */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s={}.hasOwnProperty;h=function(a,b){return Object.prototype.toString.call(a)==="[object "+b+"]"},g=function(a){return h(a,"String")},e=function(a){return h(a,"Number")},f=function(a){return h(a,"Object")},b=function(a){return h(a,"Array")},c=function(a){return b(a)||a&&!g(a)&&e(a.length)},g=function(a){return h(a,"String")},d=function(a){return h(a,"Function")},a=function(b,d){var e,g,h,i,j,k,l;if(c(b)){if(d){for(h=[],k=0,l=b.length;l>k;k++)e=b[k],h.push(a(e,d));return h}return Array.prototype.slice.call(b)}if(f(b)){i={};for(g in b)s.call(b,g)&&(j=b[g],i[g]=d?a(j,d):j);return i}return b},p="[a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+",n="[a-zA-Z0-9\\-\\._\\~\\+\\/]+[=]{0,2}",j='"((?:[^"\\\\]|\\\\.)*)"',k="("+p+")="+j,i="("+p+")=("+p+")",m=new RegExp("^[,\\s]*("+p+")\\s(.*)"),l=new RegExp("^[,\\s]*"+k+"[,\\s]*(.*)"),q=new RegExp("^[,\\s]*"+i+"[,\\s]*(.*)"),o=new RegExp("^("+n+")(?:$|[,\\s])(.*)"),r=function(){function b(a){return this instanceof b?void this.parse(a):new b(a)}return b.prototype.isProxy=!1,b.prototype._key="WWW-Authenticate",b.prototype._proxyKey="Proxy-Authenticate",b.prototype._error=null,b.prototype._header=null,b.prototype._challenges=[],b.parse=function(a){return new b(a)},b.prototype.parse=function(a){var c,e;return arguments.length||(a=this._header),this.isProxy=!1,e=a,f(a)?d(a.getResponseHeader)?(e=a.getResponseHeader(this._key),e&&g(e)||(e=a.getResponseHeader(this._proxyKey),e&&g(e)&&(this.isProxy=!0))):d(a.getHeader)?(e=a.getHeader(this._key),e&&g(e)||(e=a.getHeader(this._proxyKey),e&&g(e)&&(this.isProxy=!0))):d(a.headers)&&(e=a.headers(this._key),e&&g(e)||(e=a.headers(this._proxyKey),e&&g(e)?this.isProxy=!0:(e=a.headers()[this._key],e&&g(e)||(e=a.headers()[this._proxyKey],e&&g(e)&&(this.isProxy=!0))))):d(a)&&(e=a(this._key),e&&g(e)||(e=a(this._proxyKey),e&&g(e)&&(this.isProxy=!0))),a=e,this._challenges=[],a&&g(a)&&(this._header=a,c=new b.Parser,c.parse(a),c.error?(this._error=c.error,this._challenges=[]):this._challenges=c.toObject()),this._error||this._challenges.length||(this._error="invalid_syntax"),this},b.prototype.get=function(a,b){var c,i,j,k,l,m,n,o;if(k=[],i=this.toObject(),h(i,"Error"))return i;if(e(a))k=i[a]||null;else if(d(a))for(j=l=0,n=i.length;n>l;j=++l)c=i[j],a(c,j,i)&&k.push(c);else if(g(a)){for(a=a.toLowerCase(),j=m=0,o=i.length;o>m;j=++m)if(c=i[j],c&&c.scheme===a)if(e(b)){if(0===b){k=c;break}b--}else if(g(b)){if(b===c.params.realm){k=c;break}}else d(b)?b(c,j,i)&&k.push(c):k.push(c)}else k=i;return k&&(f(k)||k.length)?k:null},b.prototype.toObject=function(){return this._error?new Error(this._error):a(this._challenges,!0)},b}(),r.Parser=function(){function c(a){this.remainder=null!=a?a:""}return c.prototype.remainder="",c.prototype.challenges=[],c.prototype.error=null,c.prototype.realmRequired=["basic","digest"],c.prototype.parse=function(a){var b;for(g(a)&&(this.remainder=a),this.challenges=[];b=this.getScheme();)this.beginChallenge(b);return this.challenges.length||(this.error="invalid_syntax"),this},c.prototype.beginChallenge=function(a){var c,d,e,h,i;for(a=a.toLowerCase(),c={scheme:a},i={},d=function(b){return function(){return b.realmRequired.indexOf(a)>=0&&!i.realm?void(b.challenges.length||(b.error="invalid_syntax")):(c.params=i,b.error=null,void b.challenges.push(c))}}(this),e=!1;h=this.getParam();)if(h.length){if(2===h.length){if(b(i))continue;if("realm"===h[0]&&g(i.realm)){i.realm="",this.challenges.length||(this.error="invalid_syntax");continue}i[h[0]]=h[1]}else{if(f(i)){if(e){if("="===h[0][h[0].length-1])continue;return d(),this.beginChallenge(h[0])}i=[]}i.push(h[0])}e=!0}d()},c.prototype.getParam=function(){var a,b,c,d,e,f,g;if(d=this.remainder,c=d.match(l)){if(d=c[0],b=c[1],f=c[2],e=c[3],this.remainder=e||"",g=f,f.indexOf("\\")>=0)try{g=JSON.parse('"'+f+'"')}catch(h){a=h,g=f}return[b.toLowerCase(),g]}return(c=d.match(q))?(d=c[0],b=c[1],f=c[2],e=c[3],this.remainder=e||"",b=b.toLowerCase(),"realm"===b?[]:[b,f]):(c=d.match(o))?(d=c[0],f=c[1],e=c[2],this.remainder=e||"",[f]):!1},c.prototype.getScheme=function(){var a,b,c,d;return a=this.remainder,c=a.match(m),c&&c.length>1?(d=c,a=d[0],c=d[1],b=d[2],this.remainder=b||"",c.toLowerCase()):!1},c.prototype.toObject=function(){return a(this.challenges,!0)},c}(),function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof module?module.exports=b():a.w3ap=b()}(this,function(){return r})}).call(this);